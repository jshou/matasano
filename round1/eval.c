#include "eval.h"

float english[] = {
  8.167,
  1.492,
  2.782,
  4.253,
  12.702,
  2.228,
  2.015,
  6.094,
  6.966,
  0.153,
  0.772,
  4.025,
  2.406,
  6.749,
  7.507,
  1.929,
  0.095,
  5.987,
  6.327,
  9.056,
  2.758,
  0.978,
  2.36,
  0.15,
  1.974,
  0.074
};

float english_bigrams[] = {0.039803, 0.202945, 0.414065, 0.344052, 0.018870, 0.131878, 0.203724, 0.051462, 0.323185, 0.020126, 0.118806, 0.883683, 0.369461, 1.613624, 0.017335, 0.197818, 0.007286, 0.979464, 0.873561, 1.116400, 0.112952, 0.191689, 0.090630, 0.015282, 0.266491, 0.017769, 0.205069, 0.015938, 0.007409, 0.003278, 0.450229, 0.001743, 0.000937, 0.003573, 0.100748, 0.006536, 0.000624, 0.160519, 0.004436, 0.002454, 0.188995, 0.002663, 0.000127, 0.106867, 0.032600, 0.009904, 0.187628, 0.002777, 0.003242, 0.000070, 0.120997, 0.000188, 0.460920, 0.006893, 0.069991, 0.008289, 0.457979, 0.006189, 0.004199, 0.465591, 0.195325, 0.000960, 0.166625, 0.131430, 0.006613, 0.004349, 0.618324, 0.008855, 0.003643, 0.127525, 0.031951, 0.274940, 0.106473, 0.002179, 0.005949, 0.000123, 0.026487, 0.001339, 0.406650, 0.141224, 0.087474, 0.092534, 0.625093, 0.093288, 0.056477, 0.106051, 0.501234, 0.018486, 0.012158, 0.070556, 0.081980, 0.065690, 0.303421, 0.072732, 0.006552, 0.131862, 0.241202, 0.364459, 0.135549, 0.028643, 0.113475, 0.000634, 0.051295, 0.002267, 1.002047, 0.225220, 0.596092, 1.078783, 0.427784, 0.306472, 0.191633, 0.174813, 0.370639, 0.029069, 0.055772, 0.534032, 0.419629, 1.132975, 0.312761, 0.324328, 0.033797, 1.783814, 1.319814, 0.760212, 0.084968, 0.244535, 0.341720, 0.130647, 0.174101, 0.010764, 0.193286, 0.020540, 0.036326, 0.017299, 0.197249, 0.140734, 0.014749, 0.034865, 0.277370, 0.006241, 0.005294, 0.066854, 0.028938, 0.012358, 0.437632, 0.027748, 0.001099, 0.192857, 0.047349, 0.316736, 0.072590, 0.005659, 0.023263, 0.000447, 0.018269, 0.000721, 0.259932, 0.027390, 0.030053, 0.020346, 0.333594, 0.033886, 0.033956, 0.228495, 0.164268, 0.004092, 0.003789, 0.059591, 0.027254, 0.056114, 0.189372, 0.028103, 0.001382, 0.161650, 0.090670, 0.169930, 0.087149, 0.004319, 0.036261, 0.000342, 0.022659, 0.000659, 0.831887, 0.023450, 0.033326, 0.019166, 2.328545, 0.019294, 0.009935, 0.030758, 0.635859, 0.004392, 0.004865, 0.027045, 0.031290, 0.032005, 0.456254, 0.022632, 0.002341, 0.088873, 0.056937, 0.193138, 0.064101, 0.004568, 0.032451, 0.000174, 0.033451, 0.000857, 0.231307, 0.060092, 0.496480, 0.298252, 0.289204, 0.132753, 0.220405, 0.014123, 0.014040, 0.005068, 0.059784, 0.413438, 0.243851, 2.027553, 0.490507, 0.077440, 0.006744, 0.270144, 0.863758, 0.877368, 0.013336, 0.211123, 0.021324, 0.020336, 0.002275, 0.043149, 0.039609, 0.000448, 0.000573, 0.000507, 0.034396, 0.000292, 0.000278, 0.000485, 0.008269, 0.000372, 0.000323, 0.000281, 0.000517, 0.000334, 0.062934, 0.000798, 0.000017, 0.001861, 0.000909, 0.000472, 0.067639, 0.000206, 0.000372, 0.000017, 0.000132, 0.000066, 0.065517, 0.010588, 0.009713, 0.006429, 0.246308, 0.012427, 0.004839, 0.015034, 0.134463, 0.001776, 0.002748, 0.019572, 0.011230, 0.044028, 0.040656, 0.008687, 0.000322, 0.011725, 0.074635, 0.033394, 0.011716, 0.001692, 0.016642, 0.000118, 0.012796, 0.000259, 0.536023, 0.056975, 0.053839, 0.236940, 0.702645, 0.062499, 0.021426, 0.029464, 0.538633, 0.005050, 0.026923, 0.569754, 0.051259, 0.017398, 0.360681, 0.058832, 0.001784, 0.034807, 0.200629, 0.157657, 0.101823, 0.028637, 0.042478, 0.000358, 0.317799, 0.001325, 0.504804, 0.095320, 0.025479, 0.011127, 0.629901, 0.016537, 0.006594, 0.016439, 0.281420, 0.003105, 0.002568, 0.011066, 0.086272, 0.012914, 0.299500, 0.181197, 0.000494, 0.015278, 0.090720, 0.070672, 0.086858, 0.003152, 0.021683, 0.000330, 0.045076, 0.000423, 0.544561, 0.083316, 0.351854, 1.068292, 0.632074, 0.114482, 0.891911, 0.090548, 0.403598, 0.031052, 0.070377, 0.085404, 0.087808, 0.119814, 0.436946, 0.068641, 0.005028, 0.055354, 0.492733, 1.172516, 0.086320, 0.050751, 0.097499, 0.001731, 0.100443, 0.006162, 0.151573, 0.143671, 0.176844, 0.175994, 0.060505, 0.706290, 0.096277, 0.075267, 0.123415, 0.015288, 0.078572, 0.317440, 0.487177, 1.316225, 0.235165, 0.241886, 0.002837, 1.057443, 0.314428, 0.464557, 0.719504, 0.169977, 0.337882, 0.015034, 0.044700, 0.005286, 0.279102, 0.008541, 0.009258, 0.006317, 0.360149, 0.009671, 0.004883, 0.065339, 0.128563, 0.001088, 0.001920, 0.226918, 0.021536, 0.003044, 0.275606, 0.112702, 0.000430, 0.305060, 0.054971, 0.088167, 0.089224, 0.001112, 0.012266, 0.000158, 0.009161, 0.000224, 0.001700, 0.000632, 0.000247, 0.000201, 0.000139, 0.000203, 0.000059, 0.000284, 0.001697, 0.000031, 0.000047, 0.000222, 0.000285, 0.000088, 0.000217, 0.000140, 0.000058, 0.000138, 0.000482, 0.000391, 0.096422, 0.000097, 0.000802, 0.000018, 0.000105, 0.000006, 0.662459, 0.077385, 0.161283, 0.208727, 1.408922, 0.079466, 0.107442, 0.068654, 0.639080, 0.011983, 0.103868, 0.111080, 0.170624, 0.163377, 0.675992, 0.082981, 0.003629, 0.136356, 0.491134, 0.496194, 0.123275, 0.062266, 0.077426, 0.000894, 0.203244, 0.002623, 0.695635, 0.128435, 0.249776, 0.088856, 0.729217, 0.140468, 0.047264, 0.387896, 0.595700, 0.016291, 0.053696, 0.114821, 0.129061, 0.096158, 0.552797, 0.244457, 0.018509, 0.081261, 0.437445, 1.249232, 0.231978, 0.020399, 0.200578, 0.001179, 0.051207, 0.001846, 0.604691, 0.088236, 0.120182, 0.054266, 0.978135, 0.077899, 0.035384, 2.705698, 0.991845, 0.012938, 0.014115, 0.124953, 0.086951, 0.041213, 1.066462, 0.071007, 0.003680, 0.365882, 0.437603, 0.447893, 0.196051, 0.016145, 0.206059, 0.000651, 0.185215, 0.006475, 0.106149, 0.069167, 0.132799, 0.080930, 0.113961, 0.016232, 0.111753, 0.007848, 0.080513, 0.002039, 0.011907, 0.235272, 0.101517, 0.352388, 0.015030, 0.122729, 0.000541, 0.401045, 0.363064, 0.350063, 0.001458, 0.004904, 0.008157, 0.003349, 0.012302, 0.003555, 0.095080, 0.000675, 0.001365, 0.001980, 0.678078, 0.000650, 0.000592, 0.000698, 0.216923, 0.000264, 0.000265, 0.001134, 0.000810, 0.000765, 0.052110, 0.001447, 0.000034, 0.002230, 0.004720, 0.001455, 0.001916, 0.000516, 0.001055, 0.000074, 0.005390, 0.000061, 0.389415, 0.009131, 0.010370, 0.010005, 0.304920, 0.007775, 0.003235, 0.274111, 0.351817, 0.002300, 0.003445, 0.015212, 0.011695, 0.084401, 0.210601, 0.007441, 0.000376, 0.028370, 0.045991, 0.030094, 0.004183, 0.001478, 0.015601, 0.000108, 0.012804, 0.001222, 0.020909, 0.002175, 0.016142, 0.001390, 0.015123, 0.002614, 0.000909, 0.003853, 0.023698, 0.000246, 0.000316, 0.001378, 0.002948, 0.000803, 0.004884, 0.042568, 0.000125, 0.002082, 0.003569, 0.034920, 0.003412, 0.000720, 0.002759, 0.000811, 0.002181, 0.000048, 0.167422, 0.062366, 0.072340, 0.049081, 0.150303, 0.053311, 0.024261, 0.052988, 0.103170, 0.008757, 0.009064, 0.046574, 0.058191, 0.034357, 0.210181, 0.059708, 0.002034, 0.046759, 0.174362, 0.155272, 0.016084, 0.009516, 0.078144, 0.000392, 0.007700, 0.001810, 0.021487, 0.001171, 0.000949, 0.000761, 0.039543, 0.000663, 0.000610, 0.002489, 0.014894, 0.000166, 0.000561, 0.001851, 0.001065, 0.000561, 0.009806, 0.000703, 0.000134, 0.000756, 0.002197, 0.001317, 0.002626, 0.000332, 0.001593, 0.000057, 0.002448, 0.005117};

float eval(char *message, int length) {
  int n = 2;
  int combinations = pow(26, n);
  float vector[combinations];
  for (int i = 0; i < combinations; i++) { vector[i] = 0.0; }

  get_vector(message, vector, length);
  return cosin_sim(english_bigrams, vector, combinations);
}

void get_vector(char *message, float vector[], int length) {
  for (int i = 0; i < length; i++) {
    char c = tolower(message[i]);
    if (isalpha(c)) {
      vector[c - 'a']++;
    }
  }

  for (int i = 0; i < 26; i++) {
    vector[i] /= (float) length;
    vector[i] *= 100.0; // percentage
  }
}

int get_ngram_key(char *ngram, int length) {
  int key = 0;

  for (int i = 0; i < length; i++) {
    key += ngram[i - 'a'] * pow(26, length - i);
  }

  return key;
}

float cosin_sim(float a[], float b[], int length) {
  float numerator = 0.0;
  float sum_a = 0.0;
  float sum_b = 0.0;

  for (int i = 0; i < length; i++) {
    numerator += a[i] * b[i];
    sum_a += a[i] * a[i];
    sum_b += b[i] * b[i];
  }

  float denom = sqrtf(sum_a) * sqrtf(sum_b);

  if (denom) {
    return numerator / denom;
  } else {
    return 0.0;
  }
}

